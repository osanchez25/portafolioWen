<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Spa Canino Elly — Portafolio</title>

  <!-- Fuentes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;800&family=Inter:wght@300;400;500;600&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" href="styles/index.css">
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <img src="assets/wen.JPEG" alt="Foto del propietario" class="owner-pic" />
      <div>
        <h1>Spa Canino Elly <span style="font-weight:600;color:#d6e6ff">por Wendy Cordero</span></h1>
        <div class="sub">Transformaciones para peludos con alma de protagonista ✨</div>
      </div>
      <span class="tag">Grooming • Estilo • Mimos fotogénicos</span>
    </header>

    <section>
      <div class="section-title">Galería destacada</div>
      <div class="grid" id="cardsGrid"></div>
    </section>

    <footer style="margin-top:48px;padding:24px 0;text-align:center;color:#A8B3C7">
      © <span id="year"></span> By Oscar Sanchez
    </footer>
  </div>

  <!-- Modal -->
  <div class="modal" id="petModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-card">
      <div class="modal-head">
        <strong class="modal-title" id="modalTitle">Detalle</strong>
        <button class="modal-close" id="modalClose" aria-label="Cerrar">✕</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <!-- Visor de imagen a tamaño completo -->
  <div class="img-modal" id="imgModal" role="dialog" aria-modal="true">
    <button class="img-modal-close" id="imgModalClose" aria-label="Cerrar imagen">✕</button>
    <button class="img-modal-prev" id="imgModalPrev" aria-label="Imagen anterior">‹</button>
    <img id="imgModalImg" alt="" />
    <button class="img-modal-next" id="imgModalNext" aria-label="Imagen siguiente">›</button>
  </div>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const toolIcon = (t='')=>{
      const s=t.toLowerCase();
      if(s.includes('shampoo'))return'🫧';
      if(s.includes('acondicion'))return'🫧';
      if(s.includes('keratina'))return'🧴';
      if(s.includes('secadora')||s.includes('sopladora'))return'💨';
      if(s.includes('uñas'))return'🧰';
      if(s.includes('tijera'))return'✂️';
      if(s.includes('máquina')||s.includes('maquina'))return'🔌';
      if(s.includes('peine'))return'🪮';
      if(s.includes('cepillo'))return'🧹';
      if(s.includes('algodón'))return'💊';
      if(s.includes('oídos')||s.includes('oidos'))return'🧼';
      if(s.includes('talco hemost'))return'🧴';
      if(s.includes('pinza hemost'))return'🔧';
      if(s.includes('bálsamo')||s.includes('balsamo'))return'🧴';
      if(s.includes('perfume'))return'🌸';
      if(s.includes('bozal'))return'🦴';
      if(s.includes('papel aluminio'))return'🧻';
      if(s.includes('tinte'))return'🎨';
      if(s.includes('pañ')||s.includes('paño'))return'🧽';
      if(s.includes('lavanda')||s.includes('menta')||s.includes('eucalipto')||s.includes('alpiste')||s.includes('esencia'))return'🌿';
      if(s.includes('accesorio'))return'🎀';
      return'🧩';
    };
    const makeToolsBadges=(tools=[])=>tools.length
      ?'<div class="tool-badges">'+tools.map(t=>`<span class="tool"><span class="i">${toolIcon(t)}</span>${t}</span>`).join('')+'</div>'
      :'';

    function wireCarousel(root){
      root.querySelectorAll('[data-carousel]').forEach(c=>{
        const track=c.querySelector('.track'), prev=c.querySelector('.prev'), next=c.querySelector('.next');
        const imgs=track?track.querySelectorAll('img'):[];
        if(!track||!prev||!next||imgs.length===0) return;
        let idx=0;
        const update=()=>{ track.style.transform=`translateX(-${idx*100}%)`; };
        prev.addEventListener('click',()=>{ idx=(idx-1+imgs.length)%imgs.length; update(); });
        next.addEventListener('click',()=>{ idx=(idx+1)%imgs.length; update(); });
        imgs.forEach((img,i)=>{
          img.tabIndex=0;
          img.setAttribute('role','button');
          img.addEventListener('click',()=>openImgModal(imgs,i));
          img.addEventListener('keydown',e=>{ if(e.key==='Enter' || e.key===' ') openImgModal(imgs,i); });
        });
        update();
      });
    }

    const modal=document.getElementById('petModal');
    const modalBody=document.getElementById('modalBody');
    const modalTitle=document.getElementById('modalTitle');
    const closeBtn=document.getElementById('modalClose');

    const imgModal=document.getElementById('imgModal');
    const imgModalImg=document.getElementById('imgModalImg');
    const imgModalClose=document.getElementById('imgModalClose');
    const imgModalPrev=document.getElementById('imgModalPrev');
    const imgModalNext=document.getElementById('imgModalNext');
    let imgModalImgs=[];
    let imgModalIdx=0;
    function openModal(idx){
      const tmpl=document.getElementById('pet-detail-'+idx);
      if(!tmpl) return;
      modalBody.innerHTML=tmpl.innerHTML;
      modalTitle.textContent=tmpl.getAttribute('data-title')||'Detalle';
      modal.classList.add('open');
      document.body.classList.add('no-scroll'); // lock background
      wireCarousel(modalBody);
      closeBtn.focus();
    }
    function closeModal(){
      modal.classList.remove('open');
      modalBody.innerHTML='';
      document.body.classList.remove('no-scroll');
    }
    closeBtn.addEventListener('click',closeModal);
    modal.addEventListener('click',e=>{ if(e.target===modal) closeModal(); });

    function showImgModal(){
      const img=imgModalImgs[imgModalIdx];
      if(!img) return;
      imgModalImg.src=img.src;
      imgModalImg.alt=img.alt||'';
      const many=imgModalImgs.length>1;
      imgModalPrev.style.display=many?'block':'none';
      imgModalNext.style.display=many?'block':'none';
    }
    function openImgModal(imgs,idx){
      imgModalImgs=[...imgs];
      imgModalIdx=idx;
      showImgModal();
      imgModal.classList.add('open');
      document.body.classList.add('no-scroll');
      imgModalClose.focus();
    }
    function closeImgModal(){
      imgModal.classList.remove('open');
      imgModalImg.src='';
      imgModalImgs=[];
      if(!modal.classList.contains('open')) document.body.classList.remove('no-scroll');
    }
    function showPrev(){
      if(imgModalImgs.length<2) return;
      imgModalIdx=(imgModalIdx-1+imgModalImgs.length)%imgModalImgs.length;
      showImgModal();
    }
    function showNext(){
      if(imgModalImgs.length<2) return;
      imgModalIdx=(imgModalIdx+1)%imgModalImgs.length;
      showImgModal();
    }
    imgModalPrev.addEventListener('click',showPrev);
    imgModalNext.addEventListener('click',showNext);
    imgModalClose.addEventListener('click',closeImgModal);
    imgModal.addEventListener('click',e=>{ if(e.target===imgModal||e.target===imgModalImg) closeImgModal(); });

    window.addEventListener('keydown',e=>{
      if(imgModal.classList.contains('open')){
        if(e.key==='Escape') closeImgModal();
        else if(e.key==='ArrowLeft') showPrev();
        else if(e.key==='ArrowRight') showNext();
      }else if(modal.classList.contains('open') && e.key==='Escape'){
        closeModal();
      }
    });

    fetch('pets.json')
      .then(r=>r.json())
      .then(pets=>renderPets(pets))
      .catch(err=>console.error('Error cargando pets.json',err));

    function renderPets(pets){
      pets.sort((a,b)=>(a.id ?? 0)-(b.id ?? 0));
      const grid=document.getElementById('cardsGrid');
      grid.innerHTML='';
      pets.forEach((p,i)=>{
        const index=p.id || (i+1);
        const card=document.createElement('article');
        card.className='card';
        card.dataset.index=index;
        const images=(p.extras||[]).filter(Boolean);
        card.innerHTML = `
          <div class="card-header">
            <h3 class="card-title">${p.title || 'Sin título'}</h3>
            <div class="card-proc">${p.name || 'Sin nombre'}</div>
          </div>
          <div class="thumb" aria-label="Vista previa de ${p.name}">
            <img src="${images[0]||''}" alt="${p.name}" loading="lazy">
          </div>
          <a href="#" class="open-detail" data-open-detail data-index="${index}" aria-label="Ver detalle de ${p.name}" tabindex="0"></a>
        `;
        grid.appendChild(card);

        const tmpl=document.createElement('template');
        tmpl.id='pet-detail-'+index;
        tmpl.setAttribute('data-title', p.name||'Detalle');
        const imgHtml=images.map(ph=>`<img src="${ph}" alt="Foto de ${p.name}" loading="lazy">`).join('');
        tmpl.innerHTML=`
          <div class="detail-grid">
            <div>
              <div class="carousel" data-carousel>
                <button class="prev" aria-label="Foto anterior">‹</button>
                <div class="track">${imgHtml}</div>
                <button class="next" aria-label="Foto siguiente">›</button>
              </div>
            </div>
            <div>
              <div class="section-sub">Procedimiento</div>
              <div class="text-block">${p.title || '—'}</div>

              <div class="section-sub">Descripción</div>
              <div class="text-block">${p.description||'—'}</div>

              <div class="section-sub">Herramientas</div>
              ${makeToolsBadges(p.tools)}
            </div>
          </div>
        `;
        document.body.appendChild(tmpl);

        /* Ajuste por-perro desde JSON (focusY: 0–100) */
        const focusY = (p.focusY ?? 42);
        card.querySelectorAll('.thumb img').forEach(img=>{
          img.style.objectPosition = `center ${focusY}%`;
        });
        tmpl.content.querySelectorAll('.carousel img').forEach(img=>{
          img.style.objectPosition = `center ${focusY}%`;
        });
      });

      /* Delegated click: hace clic en cualquier parte de la card */
      document.addEventListener('click', (e) => {
        const card = e.target.closest('.card');
        if (!card) return;
        const idx = card.dataset.index || card.querySelector('[data-open-detail]')?.dataset.index;
        if (idx) { e.preventDefault(); openModal(idx); }
      });

      /* Hardcoded dedication card for Yuli */
      const dedicationCard = document.createElement('article');
      dedicationCard.className = 'card dedication-card';
      dedicationCard.innerHTML = `
        <div class="card-header">
          <h3 class="card-title">Dedicación Especial</h3>
          <div class="card-proc">Agradecimiento</div>
        </div>
        <div class="thumb" aria-label="Foto de Yuli">
          <img src="assets/yuli.jpg" alt="Yuli" loading="lazy" style="object-position: center 50%;">
        </div>
        <div class="dedication-text">
          A Yuli por su dedicación y trabajo en equipo, cualidades que hicieron posible este proyecto.
        </div>
      `;
      grid.appendChild(dedicationCard);
    }

    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('sw.js').catch(err=>console.error('SW registration failed',err));
    }
  </script>
</body>
</html>
