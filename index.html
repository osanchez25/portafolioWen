<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Spa Canino Elly â€” Portafolio</title>

  <!-- Fuentes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;800&family=Inter:wght@300;400;500;600&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" href="styles/index.css">
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <img src="assets/wen.JPEG" alt="Foto del propietario" class="owner-pic" />
      <div>
        <h1>Spa Canino Elly <span style="font-weight:600;color:#d6e6ff">por Wendy Cordero</span></h1>
        <div class="sub">Transformaciones Antes/DespuÃ©s para peludos con alma de protagonista âœ¨</div>
      </div>
      <span class="tag">Grooming â€¢ Estilo â€¢ Mimos fotogÃ©nicos</span>
    </header>

    <section>
      <div class="section-title">GalerÃ­a destacada</div>
      <div class="grid" id="cardsGrid"></div>
    </section>

    <footer style="margin-top:48px;padding:24px 0;text-align:center;color:#A8B3C7">
      Â© <span id="year"></span> PawGlow
    </footer>
  </div>

  <!-- Modal -->
  <div class="modal" id="petModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-card">
      <div class="modal-head">
        <strong class="modal-title" id="modalTitle">Detalle</strong>
        <button class="modal-close" id="modalClose" aria-label="Cerrar">âœ•</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const toolIcon = (t='')=>{
      const s=t.toLowerCase();
      if(s.includes('shampoo'))return'ðŸ«§';
      if(s.includes('acondicion'))return'ðŸ«§';
      if(s.includes('keratina'))return'ðŸ§´';
      if(s.includes('secadora')||s.includes('sopladora'))return'ðŸ’¨';
      if(s.includes('uÃ±as'))return'ðŸ§°';
      if(s.includes('tijera'))return'âœ‚ï¸';
      if(s.includes('mÃ¡quina')||s.includes('maquina'))return'ðŸ”Œ';
      if(s.includes('peine'))return'ðŸª®';
      if(s.includes('cepillo'))return'ðŸ§¹';
      if(s.includes('algodÃ³n'))return'ðŸ’Š';
      if(s.includes('oÃ­dos')||s.includes('oidos'))return'ðŸ§¼';
      if(s.includes('talco hemost'))return'ðŸ§´';
      if(s.includes('pinza hemost'))return'ðŸ”§';
      if(s.includes('bÃ¡lsamo')||s.includes('balsamo'))return'ðŸ§´';
      if(s.includes('perfume'))return'ðŸŒ¸';
      if(s.includes('bozal'))return'ðŸ¦´';
      if(s.includes('papel aluminio'))return'ðŸ§»';
      if(s.includes('tinte'))return'ðŸŽ¨';
      if(s.includes('paÃ±')||s.includes('paÃ±o'))return'ðŸ§½';
      if(s.includes('lavanda')||s.includes('menta')||s.includes('eucalipto')||s.includes('alpiste')||s.includes('esencia'))return'ðŸŒ¿';
      if(s.includes('accesorio'))return'ðŸŽ€';
      return'ðŸ§©';
    };
    const makeToolsBadges=(tools=[])=>tools.length
      ?'<div class="tool-badges">'+tools.map(t=>`<span class="tool"><span class="i">${toolIcon(t)}</span>${t}</span>`).join('')+'</div>'
      :'';

    function wireCompare(root){
      root.querySelectorAll('[data-compare]').forEach(c=>{
        const after=c.querySelector('.after'), slider=c.querySelector('.slider'),
              bar=c.querySelector('.bar'), knob=c.querySelector('.knob');
        if(!after||!slider||!bar||!knob) return;
        const setClip=p=>{after.style.clipPath=`inset(0 0 0 ${p}%)`; bar.style.left=p+'%'; knob.style.left=p+'%';};
        slider.addEventListener('input',e=>setClip(e.target.value));
        setClip(slider.value||50);
      });
    }

    const modal=document.getElementById('petModal');
    const modalBody=document.getElementById('modalBody');
    const modalTitle=document.getElementById('modalTitle');
    const closeBtn=document.getElementById('modalClose');
    function openModal(idx){
      const tmpl=document.getElementById('pet-detail-'+idx);
      if(!tmpl) return;
      modalBody.innerHTML=tmpl.innerHTML;
      modalTitle.textContent=tmpl.getAttribute('data-title')||'Detalle';
      modal.classList.add('open');
      document.body.classList.add('no-scroll'); // lock background
      wireCompare(modalBody);
      closeBtn.focus();
    }
    function closeModal(){
      modal.classList.remove('open');
      modalBody.innerHTML='';
      document.body.classList.remove('no-scroll');
    }
    closeBtn.addEventListener('click',closeModal);
    modal.addEventListener('click',e=>{ if(e.target===modal) closeModal(); });
    window.addEventListener('keydown',e=>{ if(e.key==='Escape'&&modal.classList.contains('open')) closeModal(); });

    fetch('pets.json')
      .then(r=>r.json())
      .then(pets=>renderPets(pets))
      .catch(err=>console.error('Error cargando pets.json',err));

    function renderPets(pets){
      const grid=document.getElementById('cardsGrid');
      grid.innerHTML='';
      pets.forEach((p,i)=>{
        const index=i+1;
        const shortProc=(p.procedure||'').split(/[.\n\r]/)[0].split(' ').slice(0,8).join(' ') + ((p.procedure||'').split(' ').length>8?'â€¦':'');
        const card=document.createElement('article');
        card.className='card';
        card.dataset.index=index;
        card.innerHTML = `
          <div class="card-header">
            <h3 class="card-title">${p.name || 'Sin nombre'}</h3>
            <div class="card-proc">${shortProc || 'â€”'}</div>
          </div>
          <div class="thumb" aria-label="Vista previa de ${p.name}">
            <img class="after" src="${p.after}" alt="${p.name} despuÃ©s" loading="lazy">
            <img class="before" src="${p.before}" alt="${p.name} antes" loading="lazy">
            <span class="pill">Antes/DespuÃ©s</span>
          </div>
          <a href="#" class="open-detail" data-open-detail data-index="${index}" aria-label="Ver detalle de ${p.name}" tabindex="0"></a>
        `;
        grid.appendChild(card);

        const tmpl=document.createElement('template');
        tmpl.id='pet-detail-'+index;
        tmpl.setAttribute('data-title', p.name||'Detalle');
        const extras=(p.extras||[]).map(ph=>`<img src="${ph}" alt="Foto extra de ${p.name}" loading="lazy">`).join('');
        tmpl.innerHTML=`
          <div class="detail-grid">
            <div>
              <div class="compare" data-compare style="margin-bottom:14px" aria-label="Comparar antes y despuÃ©s de ${p.name}">
                <img class="before" src="${p.before}" alt="${p.name} antes" loading="lazy">
                <img class="after"  src="${p.after}"  alt="${p.name} despuÃ©s" loading="lazy">
                <input class="slider" type="range" min="0" max="100" value="50" aria-label="Arrastra para ver el despuÃ©s">
                <div class="bar" aria-hidden="true"></div>
                <div class="knob" aria-hidden="true"></div>
              </div>
              ${extras ? '<div class="section-sub">MÃ¡s fotos</div><div class="gallery">'+extras+'</div>' : ''}
            </div>
            <div>
              <div class="section-sub">Procedimiento</div>
              <div class="text-block">${p.procedure||'â€”'}</div>

              <div class="section-sub">DescripciÃ³n</div>
              <div class="text-block">${p.description||'â€”'}</div>

              <div class="section-sub">Herramientas</div>
              ${makeToolsBadges(p.tools)}
            </div>
          </div>
        `;
        document.body.appendChild(tmpl);

        /* Ajuste por-perro desde JSON (focusY: 0â€“100) */
        const focusY = (p.focusY ?? 42);
        card.querySelectorAll('.thumb img').forEach(img=>{
          img.style.objectPosition = `center ${focusY}%`;
        });
        tmpl.content.querySelectorAll('.compare img').forEach(img=>{
          img.style.objectPosition = `center ${focusY}%`;
        });
      });

      /* Delegated click: hace clic en cualquier parte de la card */
      document.addEventListener('click', (e) => {
        const card = e.target.closest('.card');
        if (!card) return;
        const idx = card.dataset.index || card.querySelector('[data-open-detail]')?.dataset.index;
        if (idx) { e.preventDefault(); openModal(idx); }
      });
    }
  </script>
</body>
</html>
